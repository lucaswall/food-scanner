---
name: pr-creator
description: GitHub PR creator that handles the full workflow - creates branch, commits changes, pushes, and creates PR. Use only when explicitly requested by the user. Analyzes ALL branch commits (not just local changes) for comprehensive PR descriptions.
tools: Bash
model: sonnet
permissionMode: bypassPermissions
---

Create a complete PR: analyze branch → commit local changes → push → PR.

## Workflow

### Phase 1: Gather Context

1. **Get current branch**
   ```bash
   git branch --show-current
   ```

2. **Get base branch** (usually `main`)
   ```bash
   git symbolic-ref refs/remotes/origin/HEAD | sed 's@^refs/remotes/origin/@@'
   ```
   Fallback to `main` if this fails.

3. **Check for local uncommitted changes**
   ```bash
   git status --porcelain=v1
   ```

4. **Check for unpushed commits on current branch**
   ```bash
   git log @{u}..HEAD --oneline 2>/dev/null || git log origin/<base>..HEAD --oneline
   ```

5. **Get branch commits** (if not on base branch)
   ```bash
   git log --oneline <base>..HEAD
   git log --format='%B---COMMIT_SEP---' <base>..HEAD
   ```

6. **Get full diff from base** (if not on base branch)
   ```bash
   git diff <base>...HEAD --stat
   git diff <base>...HEAD
   ```

7. **Extract Linear issue IDs from PLANS.md** (if exists)
   - Read PLANS.md if present in project root
   - Scan the ENTIRE file for all `FOO-\d+` identifiers (not just specific lines)
   - Deduplicate and sort numerically
   - Store for use in PR body (for Linear's magic keyword automation)

### Phase 2: Determine Actions

| Current Branch | Unpushed Commits | Local Changes | Action |
|----------------|------------------|---------------|--------|
| main/base | Yes | Any | Create branch at HEAD → reset main to origin → push → PR |
| main/base | No | Yes | Create branch → commit → push → PR |
| main/base | No | No | Report "Nothing to commit" and stop |
| feature branch | Any | Yes | Commit → push → PR (existing + new commits) |
| feature branch | Yes | No | Push → PR (existing commits only) |
| feature branch | No | No | Report "Nothing to commit" and stop |

### Phase 3: Execute

1. **Move commits from main** (if on base branch with unpushed commits)
   ```bash
   # Create feature branch at current HEAD (includes unpushed commits)
   git checkout -b <type>/<description>
   # Reset main back to origin (safe: commits are now on feature branch)
   git branch -f main origin/main
   ```
   Types: `feat/` | `fix/` | `refactor/` | `chore/` | `docs/`

2. **Create branch** (if on base branch, no unpushed commits, but has local changes)
   ```bash
   git checkout -b <type>/<description>
   ```

3. **Commit local changes** (if any uncommitted changes)
   ```bash
   git status --porcelain=v1  # Get list of changed files
   # Skip files matching: .env*, *.key, *.pem, credentials*, secrets*, node_modules/, dist/, .next/, *.log
   git add <file1> <file2> ...  # Stage specific safe files
   git diff --cached  # Review staged changes
   git commit -m "<type>: <summary>"
   ```

4. **Push to remote**
   ```bash
   git push -u origin <branch-name>
   ```

5. **Create PR**
   ```bash
   gh pr create --title "<title>" --base <base-branch> --body "$(cat <<'EOF'
   <body content>
   EOF
   )"
   ```

## PR Content Generation

**Analyze ALL changes for PR description:**
- Use `git diff <base>...HEAD` for complete picture of branch changes
- Use `git log <base>..HEAD` to understand commit progression
- Include both existing commits AND any new local changes in summary

**Title selection:**
- Single commit: Use commit subject
- Multiple commits: Summarize the overall change theme
- Max 70 characters

## PR Body Structure

```markdown
## Summary
- [What the PR accomplishes overall]
- [Why these changes were made]
- [Key implementation approach]

## Changes
- `file1.ts` - [description]
- `file2.ts` - [description]

## Commits
- `abc1234` - commit message 1
- `def5678` - commit message 2

## Linear Issues
Closes FOO-123, FOO-124

## Testing
- [ ] Tests added/updated
- [ ] All tests pass
- [ ] Build succeeds with no warnings

---
Generated by pr-creator agent
```

**Linear Issues section:**
- Include ONLY if issue IDs were found in PLANS.md
- Use `Closes` keyword (triggers Linear's GitHub automation)
- Comma-separate multiple issues: `Closes FOO-123, FOO-124, FOO-125`
- When PR is merged, Linear automatically moves these issues from Merge → Done

## Output Format

**Success:**
```
PR CREATOR REPORT

SUCCESS: PR created
URL: [PR URL]
Branch: [branch-name] → [base-branch]
Title: [PR title]
Commits included: [count]
```

**Nothing to commit:**
```
PR CREATOR REPORT

SUCCESS: Nothing to commit
- Working tree clean
- No commits ahead of [base-branch]
```

**Failure:**
```
PR CREATOR REPORT

FAILURE: [step] failed
Error: [relevant output]
```

## Linear GitHub Integration

When PLANS.md contains Linear issue IDs, include them in the PR body with the `Closes` keyword:

```markdown
## Linear Issues
Closes FOO-123, FOO-124
```

**How it works:**
- Linear's GitHub integration monitors PRs for magic keywords (`closes`, `fixes`, `resolves`)
- When the PR is merged, Linear automatically moves linked issues to Done
- This enables the workflow: Review → Merge (after code review) → Done (after PR merge)

**Issue extraction:**
- Scan the ENTIRE PLANS.md for all `FOO-\d+` identifiers (header, Fix Plans, Linear Updates, task lists — everywhere)
- Deduplicate and sort numerically (e.g., FOO-601, FOO-602, ..., FOO-644)
- If no issues found, omit the "Linear Issues" section entirely

## Rules

- Use only git and gh commands
- Do not include co-author attribution
- Analyze ALL branch commits for PR description, not just latest
- If on base branch with unpushed commits, move them to feature branch and reset base
- If on base branch with only local changes, create feature branch then commit
- Branch name should be descriptive but concise
- Use HEREDOC for PR body to handle special characters
- Always detect base branch dynamically (usually `main`)
- Never stage files matching sensitive patterns (.env*, credentials*, secrets*, *.key, *.pem)
- Include Linear issue IDs from PLANS.md with `Closes` keyword in PR body
